#ifndef _SKYPEKITVIDEOTRANSPORTCLIENT_H_
#define _SKYPEKITVIDEOTRANSPORTCLIENT_H_

#ifdef SKYPEKIT_SURFACE_RENDERING

#include "SidPlatform.hpp"
#include "SkypekitVideoTransportBase.hpp"

#ifndef SID_MAKEFOURCC
#define SID_MAKEFOURCC(ch0, ch1, ch2, ch3) \
	( (unsigned long)(unsigned char)(ch0)         | ( (unsigned long)(unsigned char)(ch1) << 8 ) | \
	  ( (unsigned long)(unsigned char)(ch2) << 16 ) | ( (unsigned long)(unsigned char)(ch3) << 24 ) )
#endif

class SkypekitVideoTransportClient : public SkypekitVideoTransportBase, public Sid::Thread {
	public:
		SkypekitVideoTransportClient();
		~SkypekitVideoTransportClient();


		bool SetPreferences(unsigned long *colorspaces, int count );

		virtual bool Allocate( bufferstruct *b ) {
			return false;
		};
		virtual void FreeBuffer( bufferstruct *b ) = 0;

		virtual bool Present( bufferstruct *b, long long ts ) {
			return false;
		};

		bufferstruct * LatestBuffer();

		void Run( void );
		bool ReceiveCommand( bool nowait );
		
		void AddFreeBuffer( bufferstruct *b );

		virtual int pitchfor( unsigned long colorspace, int bitsPerPixel, int width, int height );
	private:
		bufferstruct *latest_data;

		int ssize;

};
#endif

#endif
