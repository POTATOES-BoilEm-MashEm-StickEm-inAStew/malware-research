#!/bin/bash
#
# Helper script to generate the SkypeKit Python wrapper
#
# There is bug in LUA that causes some linebreaks to get lost when generating the Python wrapper.
# This script implements a hack to workaround it. Use it to generate the wrapper, don't call
# the lua script directly.

if [ "$OSTYPE" = "cygwin" ]; then
    LUAEXE="lua.exe"
    # putting it here, might not be writable under cygwin
    TEMP_PATH=.
else
    LUAEXE="lua"
    TEMP_PATH=/tmp
fi


# We generate with tab indentation, fix the result and replace the tabs with spaces

$LUAEXE generate_skylib_pyclient.lua -t

perl -i -p -e 's/([^\t])(\t+[^\t])/$1\n$2/' Skype.py

if [ "$OSTYPE" = "darwin10.0" ]; then
	# Doesn't work with Mac sed, use GNU sed (or fix it to make it work with both)
	gsed -i 's/\t/    /g' Skype.py
else
	sed -i 's/\t/    /g' Skype.py
fi

# check if it "compiles"..
cd ../../../ipc/python
export PYTHONPATH="$PYTHONPATH:`pwd`"
cd -
python Skype.py

