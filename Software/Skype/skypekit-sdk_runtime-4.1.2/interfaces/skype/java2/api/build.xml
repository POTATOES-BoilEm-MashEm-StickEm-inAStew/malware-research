<project basedir = "." default = "main" name = "sid-java-wrapper">

    <loadproperties srcFile = "local.properties" />
    <property name = "build.dir" value = "${basedir}/bin" />
    <property name = "android.dbg.build.dir" value = "${basedir}/android-debug" />
    <property name = "android.rel.build.dir" value = "${basedir}/android-release" />
    <property name = "api.dir" value = "${basedir}" />
    <property name = "ipc.dir" value = "${basedir}/../ipc" />
    <property name = "android.dir" value = "${basedir}/../android/ipc" />
    <property name = "install.dir" value = "${basedir}/../../../../lib" />

    <property name = "target.dir" value = "." />

    <target name = "all" depends = "install,install-android-release,install-android-debug" />

    <target name = "help">
        <echo>SkypeKit java wrapper build. Available targets:</echo>
        <echo>    help:         Display this help.</echo>
        <echo>    clean:        Removes files generated by other targets.</echo>
        <echo>    compile:      Compiles api and ipc classes</echo>
        <echo>    jar:          Packages source and class files into jar library.</echo>
        <echo>    clean-build:  Removes all previous files and builds the jar library.</echo>
        <echo>    install:      copies jar file to install target</echo>
        <echo>    main:         Default target. Does a clean build</echo>
        <echo />
        <echo>Android releated targets:</echo>
        <echo>    compile-android-debug:    Compile classes in debug mode.</echo>
        <echo>    compile-android-release:  Complile classes in release mode.</echo>
        <echo>    jar-android-debug:        Package classes into debug library.</echo>
        <echo>    jar-android-release:      Package classes into release library.</echo>
        <echo>    android-debug:            Top-level target for building debug library.</echo>
        <echo>    android-release:          Top-level target for building release library.</echo>
        <echo>    android-debug-install:    copies debug jar file to install target</echo>
        <echo>    android-release-install:  copies release jar file to install target</echo>
    </target>

    <target name = "clean">
        <delete dir = "${build.dir}" />
        <delete dir = "${android.rel.build.dir}" />
        <delete dir = "${android.dbg.build.dir}" />
        <delete>
            <fileset dir="." includes="*.jar" />
        </delete>
    </target>

    <target name = "compile">
        <mkdir dir = "${build.dir}" />
        <javac debug = "true"
               destdir = "${build.dir}"
               includeAntRuntime = "false">
            <compilerarg value = "-Xlint" />
            <src path = "${api.dir};${ipc.dir}" />
        </javac>
    </target>

    <target name = "jar" depends = "compile,create-manifest">
        <jar destfile = "skypekit.jar">
            <fileset dir = "${build.dir}" />
            <fileset dir = "${api.dir}"
                includes = "**/*.java"
            />
            <fileset dir = "${ipc.dir}"
                includes = "**/*.java"
            />
        </jar>
    </target>

    <target name = "clean-build" depends = "clean,jar" />

    <target name = "install" depends = "clean-build">
        <mkdir dir = "${install.dir}" />
        <copy file = "skypekit.jar" todir = "${install.dir}" />
    </target>

    <target name = "main" depends = "clean-build" />

    <!-- Android -->

    <!-- target to compile the debug version -->
    <target name = "compile-android-debug">
        <mkdir dir = "${android.dbg.build.dir}" />
        <javac debug = "true"
               destdir = "${android.dbg.build.dir}"
               includeAntRuntime = "false"
               classpath = "${android-sdk}">
            <compilerarg value = "-Xlint" />
            <src path = "${api.dir};${ipc.dir};${android.dir}" />
        </javac>
    </target>

    <!-- target to compile the release version -->
    <target name = "compile-android-release">
        <mkdir dir = "${android.rel.build.dir}" />
        <javac debug = "false"
               destdir = "${android.rel.build.dir}"
               includeAntRuntime = "false"
               classpath = "${android-sdk}">
            <src path = "${api.dir};${ipc.dir};${android.dir}" />
        </javac>
    </target>

    <!-- target to package debug java wrapper jar library -->
    <target name = "jar-android-debug" depends = "compile-android-debug,create-manifest">
        <jar destfile = "${target.dir}/skypekit-android-debug.jar" manifest = "Manifest.txt">
            <fileset dir = "${android.dbg.build.dir}" />
            <fileset dir = "${api.dir}"     includes = "**/*.java" />
            <fileset dir = "${android.dir}" includes = "**/*.java" />
            <fileset dir = "${ipc.dir}"     includes = "**/*.java" />
        </jar>
    </target>

    <!-- target to package release java wrapper jar library -->
    <target name = "jar-android-release" depends = "compile-android-release,create-manifest">
        <jar destfile = "${target.dir}/skypekit-android.jar" manifest = "Manifest.txt">
            <fileset dir = "${android.rel.build.dir}" />
        </jar>
    </target>

    <target name = "install-android-debug" depends = "jar-android-debug">
        <mkdir dir = "${install.dir}" />
        <copy file = "${target.dir}/skypekit-android-debug.jar" todir = "${install.dir}" />
    </target>

    <target name = "install-android-release" depends = "jar-android-release">
        <mkdir dir = "${install.dir}" />
        <copy file = "${target.dir}/skypekit-android.jar" todir = "${install.dir}" />
    </target>

    <!-- top level target for debug version of android java wrapper -->
    <target name = "android-debug" depends = "clean,create-manifest,jar-android-debug" />

    <!-- top level target for release version of android java wrapper -->
    <target name = "android-release" depends = "clean,create-manifest,jar-android-release" />

    <!-- target to create custom jar manifest source -->
    <target name = "create-manifest">
        <echo file = "Manifest.txt">Implementation-Version: ${build.id}</echo>
    </target>
</project>

